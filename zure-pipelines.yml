trigger:
  - main # or your branch name

pool:
  vmImage: "ubuntu-latest"

steps:
  - task: UseNode@1
    inputs:
      versionSpec: "16.x" # node version to run any helper code if needed

  - script: |
      # Install k6 CLI
      sudo apt-get update
      sudo apt-get install -y gnupg software-properties-common curl
      curl -s https://dl.k6.io/key.gpg | sudo apt-key add -
      echo "deb https://dl.k6.io/deb stable main" | sudo tee /etc/apt/sources.list.d/k6.list
      sudo apt-get update
      sudo apt-get install -y k6

      # Run the k6 load test
      k6 run ./path/to/your/script.js
    displayName: "Install k6 and Run Load Test"
  - task: PublishTestResults@2
    inputs:
      testResultsFormat: "JUnit"
      testResultsFiles: "**/results.xml" # Adjust this path based on your k6 output configuration
      failOnEmptyTestResults: true
      searchFolder: "$(System.DefaultWorkingDirectory)"
